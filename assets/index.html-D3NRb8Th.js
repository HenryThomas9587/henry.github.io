import{_ as l,c as h,b as i,a as n,d as e,r as t,o as k}from"./app-BNwF3TyR.js";const r={};function p(d,s){const a=t("Mermaid");return k(),h("div",null,[s[0]||(s[0]=i("h2",{id:"framework-概述",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#framework-概述"},[i("span",null,"Framework 概述")])],-1)),s[1]||(s[1]=i("p",null,"Android Framework 是 Android 操作系统的核心框架层，它提供了一套完整的系统 API 和服务，使应用开发者能够访问底层系统功能。Framework 层位于应用层和 Native 库层之间，是连接应用与底层系统的桥梁。",-1)),s[2]||(s[2]=i("h3",{id:"android-系统架构图",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#android-系统架构图"},[i("span",null,"Android 系统架构图")])],-1)),n(a,{id:"mermaid-9",code:"eJx9zT1Lw0AYwPHdT3FQcLKQF5MmGYRLLodgJnELHaI57dE0CZeU1lWwgzgIdlazObgUoUiD+GXMy8fQvBgEpTccHPf/Pc8Fc8IROEE74PtAO9ssi+VztroCMAw9eubENPCjIej3D4De/ubJIn9YVw1mzoTMAjYe1lyvM8MuXtMifSw/7srkNtvcV6VFT5nDKInALoC+ywLqguOpH9MJaaxRW2QXyctnus5v3stVUsFDaDUBqgPTtqg/nYNscZ0/vYEjwnziNUF9RfGlRwAE59TztJ7KGRCre1HMgjHRerwkSwbXPvsz6sYjTQjnv6DeQoxNThE6iLGCua3QaCGUkAwHHRTMARJ/5vwLUbcR6irfQaTsi7y0DZotNExVREoHZcjrKvwLvwCdOqxB"}),s[3]||(s[3]=e('<h2 id="framework-层的重要性" tabindex="-1"><a class="header-anchor" href="#framework-层的重要性"><span>Framework 层的重要性</span></a></h2><ol><li><strong>统一的系统服务接口</strong>：提供标准化的系统功能访问方式</li><li><strong>应用程序的运行环境</strong>：管理应用的生命周期和资源</li><li><strong>系统稳定性保障</strong>：隔离应用与底层系统，提高系统鲁棒性</li><li><strong>开发效率提升</strong>：封装复杂的底层实现，提供简洁的 API</li></ol><h2 id="framework-层的核心组成部分" tabindex="-1"><a class="header-anchor" href="#framework-层的核心组成部分"><span>Framework 层的核心组成部分</span></a></h2><h3 id="_1-核心服务-core-services" tabindex="-1"><a class="header-anchor" href="#_1-核心服务-core-services"><span>1. 核心服务（Core Services）</span></a></h3><p>Framework 层包含多个核心系统服务，每个服务负责特定的系统功能：</p>',5)),n(a,{id:"mermaid-44",code:"eJyFkVFrwjAQx9/9FAFfW+jsi+vDoOgCgoqQQR+KDyG96GFNSpra+e13SthWGFkCIXC/+3Hc/+Rkd2Yf6xmjI0Qt7r2HKxPgbuCOLE3fWLkTdak83tDfd9LIE7hHGRUcQ9cTqwir0DR2jEAHgg5SXageoyqi7AguwmzItDHd4CPMnpi99ahRSY/WRNAtoVv7L1bSKoYG7V+1lahX1hgIq5ogz0e1su/XoFkDWg6tZxrbtpjr18dNeu/sBYp5nufhn47Y+HPx0n1O268STbAHBefv2XLxreB8ybNsalkEy4+K5k4o24SCSyiXhLb+Wz37Ap6AqkY="}),s[4]||(s[4]=e('<h4 id="activitymanagerservice-ams" tabindex="-1"><a class="header-anchor" href="#activitymanagerservice-ams"><span>ActivityManagerService (AMS)</span></a></h4><ul><li>管理所有应用程序的 Activity 生命周期</li><li>处理应用程序的启动、切换和关闭</li><li>管理应用的任务栈（Task Stack）</li><li>监控应用 ANR（Application Not Responding）状态</li></ul><h4 id="windowmanagerservice-wms" tabindex="-1"><a class="header-anchor" href="#windowmanagerservice-wms"><span>WindowManagerService (WMS)</span></a></h4><ul><li>管理应用窗口的显示和叠加顺序</li><li>处理窗口的添加、移除和更新</li><li>协调输入事件的分发</li><li>与 SurfaceFlinger 配合完成界面渲染</li></ul><h4 id="packagemanagerservice-pms" tabindex="-1"><a class="header-anchor" href="#packagemanagerservice-pms"><span>PackageManagerService (PMS)</span></a></h4><ul><li>管理应用的安装、卸载和更新</li><li>解析应用的 AndroidManifest.xml 文件</li><li>维护已安装应用的信息和权限</li><li>处理应用间的组件调用和权限检查</li></ul><h4 id="powermanagerservice" tabindex="-1"><a class="header-anchor" href="#powermanagerservice"><span>PowerManagerService</span></a></h4><ul><li>管理设备的电源状态</li><li>控制屏幕点亮和熄灭</li><li>处理休眠和唤醒</li><li>管理电源相关的锁（WakeLock）</li></ul><h4 id="其他重要服务" tabindex="-1"><a class="header-anchor" href="#其他重要服务"><span>其他重要服务</span></a></h4><ul><li>InputManagerService：输入事件处理</li><li>NotificationManagerService：通知管理</li><li>LocationManagerService：位置服务</li><li>AudioService：音频服务</li><li>ConnectivityService：网络连接服务</li></ul><h3 id="_2-系统通信机制" tabindex="-1"><a class="header-anchor" href="#_2-系统通信机制"><span>2. 系统通信机制</span></a></h3><h4 id="binder-ipc-机制" tabindex="-1"><a class="header-anchor" href="#binder-ipc-机制"><span>Binder IPC 机制</span></a></h4><p>Binder 是 Android 特有的进程间通信（IPC）机制，是 Framework 层最核心的通信方式：</p>',13)),n(a,{id:"mermaid-184",code:"eJx1j8tKw0AUhvc+xXmBBuvdLAoGt1nNEwxxKFkYYlpdi4KLitZLdNPSekGIIMQgEjSVvkwnM30LJzNJSRs6i9mc7/zn+1vk6Jg4Ftm3cdPDhysgnou9tm3ZLnbasOe6gFtAf33mB3zcY8FlhUFmhiDindgWMbGDm8SrQAbKIMN2Dog3fY9oJ6jmSIR9JSwZpv0r2nkuHZSfsKk1GsjUoa4Bv45p91GBdPQg/CSDTIEYSIc1DdLhGw9fFCKHBsr2xXB9YT/84ZFCEKrlARuCGfu0N1DMJHllNxdFTO6xqcFk9DQ9vaswwkMwwliHraVBpVbZxW0NaPeWf8d5/c/zotVMfEdk/X1klBzyME6jswXx3eKeYlhynw76JXEpVV8t1Oeof62T5Qs="}),s[5]||(s[5]=e('<ul><li><strong>高效性</strong>：相比传统 IPC 机制，Binder 只需一次数据拷贝</li><li><strong>安全性</strong>：Binder 可以识别通信双方的身份</li><li><strong>面向对象</strong>：Binder 支持面向对象的接口设计</li></ul><p>Binder 通信的主要组件：</p><ul><li>ServiceManager：系统服务的注册表</li><li>Binder Driver：内核驱动，负责跨进程数据传输</li><li>AIDL：Android 接口定义语言，简化 Binder 接口开发</li></ul><h4 id="handler-消息机制" tabindex="-1"><a class="header-anchor" href="#handler-消息机制"><span>Handler 消息机制</span></a></h4><p>Handler 机制是 Framework 中另一个重要的通信方式，主要用于线程间通信：</p>',5)),n(a,{id:"mermaid-228",code:"eJxLL0osyFDwCeJSAALHaI/EvJSc1KJYBV1du5qn/RNfNjQ+29bxrHF9jYJTtG9qcXFiempgaWppaixYg3O0T35+AVz9vlXP+9Y/7Z/2tH0XXBdEHUS+ow1oJEzGEWIlRGZJy/MJbTAZF5hNEEvARHFJZU4qUHVaZk6OlbKbm6uBhZFOcUlRfnYqiGvhZmAA5eqWZ6aUZFgZFVQgaXSCanQ0dTFzNIdrNHI1dzGGmYNVozNUo6WBs6ObJVyjoamZqTNeG13gTnV0sjSEa3SxMDE2NMXUCAA6u4oa"}),s[6]||(s[6]=i("ul",null,[i("li",null,"Looper：消息循环，从 MessageQueue 中取出消息并分发"),i("li",null,"Handler：消息处理器，发送和处理消息"),i("li",null,"Message：消息载体，包含要处理的数据和操作"),i("li",null,"MessageQueue：消息队列，存储待处理的消息")],-1)),s[7]||(s[7]=i("h3",{id:"_3-系统启动流程",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#_3-系统启动流程"},[i("span",null,"3. 系统启动流程")])],-1)),s[8]||(s[8]=i("p",null,"了解 Android 系统的启动流程对理解 Framework 至关重要：",-1)),n(a,{id:"mermaid-257",code:"eJxLL0osyFAIceFSAALHaKf8/BKFIH/fWAVdXTsFJzA/Jz8xJbUoFqzCCSzuHO2TmVdaofC0rfXZgh1PJ6x/2rUCIu8MlneJ9szLLFF4sX/28xXdEAkXsIRrdFRlen5JKoqUK1jKLTq4srgkNTc4tagstQhFgRtYgXv08827n++e/2xO79OuhciWuoPlPaJ9EkvzkjOAmpElwURyTmJxsUtqmkJKalpiaU6JQlpmTo6VcpolCOoUlxTlZ6daKRsbG0PZuuWZKSUZVoYFFajaMzLTM3KAGGaAm5urgYUR3AA3Nws3AwNUM4ygZiAMUnDVcdNxR5jFBQDatYX6"}),s[9]||(s[9]=e(`<ol><li><strong>Boot ROM → Bootloader</strong>：加载并启动系统</li><li><strong>Kernel 初始化</strong>：启动设备驱动和内存管理</li><li><strong>Init 进程</strong>：第一个用户空间进程，解析 init.rc</li><li><strong>Zygote 进程</strong>：所有 Java 进程的父进程，预加载资源</li><li><strong>SystemServer 进程</strong>：启动所有系统服务</li><li><strong>启动 Launcher</strong>：显示应用图标，完成系统启动</li></ol><h2 id="framework-开发入门指南" tabindex="-1"><a class="header-anchor" href="#framework-开发入门指南"><span>Framework 开发入门指南</span></a></h2><h3 id="开发环境搭建" tabindex="-1"><a class="header-anchor" href="#开发环境搭建"><span>开发环境搭建</span></a></h3><h4 id="_1-获取-aosp-源码" tabindex="-1"><a class="header-anchor" href="#_1-获取-aosp-源码"><span>1. 获取 AOSP 源码</span></a></h4><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装 Repo 工具</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/bin</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">curl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://storage.googleapis.com/git-repo-downloads/repo</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/bin/repo</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> a+x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/bin/repo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 初始化仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> AOSP</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> AOSP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">repo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> init</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -u</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://android.googlesource.com/platform/manifest</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">repo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sync</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-编译环境准备" tabindex="-1"><a class="header-anchor" href="#_2-编译环境准备"><span>2. 编译环境准备</span></a></h4><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装依赖（Ubuntu 为例）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt-get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git-core</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gnupg</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> flex</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bison</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build-essential</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> curl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zlib1g-dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gcc-multilib</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> g++-multilib</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> libc6-dev-i386</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lib32ncurses5-dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x11proto-core-dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> libx11-dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lib32z1-dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> libgl1-mesa-dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> libxml2-utils</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xsltproc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> unzip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> fontconfig</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置环境</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">source</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build/envsetup.sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">lunch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> aosp_arm-eng</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 选择编译目标</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-编译系统" tabindex="-1"><a class="header-anchor" href="#_3-编译系统"><span>3. 编译系统</span></a></h4><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 完整编译</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 单独编译模块</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">module_nam</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="调试技巧" tabindex="-1"><a class="header-anchor" href="#调试技巧"><span>调试技巧</span></a></h3><h4 id="_1-日志分析" tabindex="-1"><a class="header-anchor" href="#_1-日志分析"><span>1. 日志分析</span></a></h4><p>使用 <code>logcat</code> 查看系统日志：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">adb</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> logcat</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">TA</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">G</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>常见日志级别：</p><ul><li>V (Verbose)：详细信息</li><li>D (Debug)：调试信息</li><li>I (Info)：一般信息</li><li>W (Warning)：警告信息</li><li>E (Error)：错误信息</li></ul><h4 id="_2-源码调试" tabindex="-1"><a class="header-anchor" href="#_2-源码调试"><span>2. 源码调试</span></a></h4><p>使用 Android Studio 进行源码调试：</p><ol><li>导入 AOSP 源码</li><li>配置远程调试</li><li>设置断点</li><li>连接设备并启动调试</li></ol><h4 id="_3-性能分析" tabindex="-1"><a class="header-anchor" href="#_3-性能分析"><span>3. 性能分析</span></a></h4><ul><li>Systrace：分析系统性能和时序</li><li>Perfetto：系统级性能分析工具</li><li>simpleperf：CPU 分析工具</li></ul><h3 id="开始修改-framework" tabindex="-1"><a class="header-anchor" href="#开始修改-framework"><span>开始修改 Framework</span></a></h3><h4 id="_1-修改系统服务" tabindex="-1"><a class="header-anchor" href="#_1-修改系统服务"><span>1. 修改系统服务</span></a></h4><p>以修改 PowerManagerService 为例：</p><ol><li>定位源码位置：<code>frameworks/base/services/core/java/com/android/server/power/PowerManagerService.java</code></li><li>修改服务实现</li><li>编译并刷入设备：<code>make updateapi &amp;&amp; make -j8</code></li></ol><h4 id="_2-添加系统属性" tabindex="-1"><a class="header-anchor" href="#_2-添加系统属性"><span>2. 添加系统属性</span></a></h4><p>在 <code>system/core/rootdir/init.rc</code> 中添加新的系统属性。</p><h4 id="_3-创建自定义系统服务" tabindex="-1"><a class="header-anchor" href="#_3-创建自定义系统服务"><span>3. 创建自定义系统服务</span></a></h4><ol><li>定义服务接口（AIDL）</li><li>实现服务类</li><li>在 SystemServer 中注册服务</li><li>在应用中调用服务</li></ol><h2 id="实例-创建简单的系统服务" tabindex="-1"><a class="header-anchor" href="#实例-创建简单的系统服务"><span>实例：创建简单的系统服务</span></a></h2><p>下面通过一个简单的例子说明如何创建系统服务：</p><h3 id="_1-定义-aidl-接口" tabindex="-1"><a class="header-anchor" href="#_1-定义-aidl-接口"><span>1. 定义 AIDL 接口</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// IMyService.aidl</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">package</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">android</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">server</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">interface</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> IMyService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> setData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">String </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    String </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-实现服务类" tabindex="-1"><a class="header-anchor" href="#_2-实现服务类"><span>2. 实现服务类</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// MyService.java</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">package</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">android</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">server</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> android</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">content</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Context</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> android</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">util</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Slog</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> MyService</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> extends</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> IMyService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Stub</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> static</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> final</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> TAG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MyService</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    private</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> mData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> MyService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Context </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">context</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        Slog</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">d</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TAG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MyService constructed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Override</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> setData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">String </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        mData </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        Slog</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">d</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TAG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Data set to: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    @</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Override</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    public</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> String </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        Slog</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">d</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TAG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Returning data: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> mData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> mData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-在-systemserver-中注册服务" tabindex="-1"><a class="header-anchor" href="#_3-在-systemserver-中注册服务"><span>3. 在 SystemServer 中注册服务</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 在 SystemServer.java 的 startOtherServices() 方法中添加</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">try</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    Slog</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">i</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TAG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">My Service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    ServiceManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">addService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">my_service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> new</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> MyService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">context</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">));</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> catch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Throwable </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">e</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    reportWtf</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">starting My Service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> e</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-在应用中调用服务" tabindex="-1"><a class="header-anchor" href="#_4-在应用中调用服务"><span>4. 在应用中调用服务</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 在应用中调用系统服务</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">IMyService</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> IMyService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Stub</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">asInterface</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    ServiceManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">my_service</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">));</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">setData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Hello from app</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">String</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getData</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义系统服务工作流程" tabindex="-1"><a class="header-anchor" href="#自定义系统服务工作流程"><span>自定义系统服务工作流程</span></a></h3>`,39)),n(a,{id:"mermaid-478",code:"eJxLL0osyFAIceFSAALH6KfrZj3Z2eno6eLzrG/p0/7FsQq6unYKTtHPp8x/1jEhuKQ06fnG3bFgxU5gKWeglnnP+zY8m9P7tGshXNIZLOkS/XTOiuDK4pLU3ODUorLUomebVzxt64EocQErcY1+umvK8ykrXvRtf9o/DWLK0z1TgSIQVa5gVW4wVRuagSREFUQeTBSXVOakKjgqpGXm5Fgpu7m5GlgY6RSXFOVnp4K4Fm4GBlCubnlmSkmGlVFBBZJGZ6hGR1MXM0dzuEYjV3MXY5g5WDW6QDVaGjg7ulnCNRqampk647XRDe5URydLQ7hGFwsTY0NTTI0AJ0Gc5w=="}),s[10]||(s[10]=e('<h2 id="学习路径建议" tabindex="-1"><a class="header-anchor" href="#学习路径建议"><span>学习路径建议</span></a></h2><ol><li><strong>掌握基础</strong>：Java/Kotlin、Linux 基础</li><li><strong>理解架构</strong>：Android 系统架构和组件交互</li><li><strong>阅读源码</strong>：从简单服务开始，逐步深入</li><li><strong>动手实践</strong>：修改和扩展现有功能</li><li><strong>解决问题</strong>：分析和修复实际问题</li></ol><h2 id="推荐资源" tabindex="-1"><a class="header-anchor" href="#推荐资源"><span>推荐资源</span></a></h2><h3 id="书籍" tabindex="-1"><a class="header-anchor" href="#书籍"><span>书籍</span></a></h3><ul><li>《深入理解 Android 内核设计思想》</li><li>《Android 系统源代码情景分析》</li></ul><h3 id="在线资源" tabindex="-1"><a class="header-anchor" href="#在线资源"><span>在线资源</span></a></h3><ul><li><a href="https://cs.android.com/" target="_blank" rel="noopener noreferrer">Android 源码在线浏览</a></li><li><a href="https://source.android.com/" target="_blank" rel="noopener noreferrer">Android 开源项目</a></li></ul><h3 id="社区" tabindex="-1"><a class="header-anchor" href="#社区"><span>社区</span></a></h3><ul><li>XDA Developers</li><li>Android 源码分析社区</li></ul><h2 id="结语" tabindex="-1"><a class="header-anchor" href="#结语"><span>结语</span></a></h2><p>Android Framework 的学习是一个渐进的过程，需要理论学习和实践相结合。通过本文的介绍，希望能够帮助你迈出 Android Framework 开发的第一步。随着不断学习和实践，你将能够更深入地理解 Android 系统的工作原理，并开发出更加高效、稳定的应用和系统功能。</p><hr><p><em>本文档仅为入门指南，随着学习的深入，建议参考更详细的技术文档和书籍。</em></p>',13))])}const o=l(r,[["render",p]]),c=JSON.parse('{"path":"/android/ugfhkbji/","title":"Framework基础入门","lang":"zh-CN","frontmatter":{"title":"Framework基础入门","createTime":"2025/04/29 14:32:19","permalink":"/android/ugfhkbji/"},"headers":[],"readingTime":{"minutes":6.99,"words":2097},"git":{"updatedTime":1745914733000,"contributors":[{"name":"Henry Thomas","username":"Henry Thomas","email":"henrythomas9587@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Henry Thomas?v=4","url":"https://github.com/Henry Thomas"}]},"filePathRelative":"notes/android/framework/01/Framework基础入门.md","bulletin":false}');export{o as comp,c as data};
