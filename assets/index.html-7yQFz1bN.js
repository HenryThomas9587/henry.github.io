import{_ as s,c as o,b as d,a as e,d as r,e as n,r as i,o as l}from"./app-BNwF3TyR.js";const h={};function p(m,t){const a=i("Mermaid");return l(),o("div",null,[t[0]||(t[0]=d("blockquote",null,[d("p",null,[n("本章基于 "),d("a",{href:"https://ddia.vonng.com/ch7/",target:"_blank",rel:"noopener noreferrer"},"DDIA 中文翻译"),n(" 整理")])],-1)),t[1]||(t[1]=d("h2",{id:"章节概览",tabindex:"-1"},[d("a",{class:"header-anchor",href:"#章节概览"},[d("span",null,"章节概览")])],-1)),e(a,{id:"mermaid-8",code:"eJydVU1PGlEU3fsrJnFbUwG/YNGEokijiwZZ9cUF1SmSUobAtNUdoiIqFFvBqGANKFGrgkQaFLT+Gd57w7/oY94MzCAbnivhnnM/zj334Qm6A0vcrHOAI39OQRABjEVhvMa9dwdFr+gV/F6/Z54bGnrDzYlBt8h7VhQEvtnH6cJ8myhj3vkX+WXQqMVx7RxX8vAxTcFdMCf/0e1z+xd4AKMJ+HAn5XLdCOGrSCoDqVRF5YhULeFUuQviEMRQgDSM125w5AGerePd6PyAjFFblXEz/IrT7ffwoJkqSvE1mKloe1KjFOo0gMbjAUln4SgUnRSkUr55dYDSsZ4EI8CPNZlA+2ie/mgeXhJCr1Yc7tASgHsxeB/X9tD6msYNajS5jy5yJGcxDBPpxlMUbV3CchqFz2G12E0ygsZ9WNqstKIy28J14IWnbrgJwEwNFo9oByh9S2Z93sX1CkyWmvl19HenV+s24UtACHlFsrKzBNyNUTaRlKZvhynYAHB9r4Wi0/yKUzXx0TqVV6kg20VmzAoLbh9A2WuYvaXG4dD+JsqdanWSQRROhIoewo0CFehF2EiMUyciNrNhkgClT19Lq0fNjOqPTt1pn0CsCODGBSyHlcJSKYGOc9rCFEUJBjW1xhPauFHpjMiEjiNKwbbhqblJ9/oVKNbWo0im7QsUXtWdkB5iAii+JW1HiKSolGr8I6vrgRoB0uYfkov7FiLO2CH/qW3RK6MoF5lMziQ9XcPkT/XatAgiq3yJsEwGexkmzirmUayKr0o4U5Gef/cCjQCYSEq3ayibgNs57oMgzPB8gA8qLSlXTa06R4SqpXCKLCdC96iYWQdq+X+vBdKelA5hAviujusnVAbdUxESV3w8fVQ+eX0+y6B52Ga1m1+FxKDwmbcMGkbHRm3Dyseh795FccliCixruO0zoXy7fWp4wtjm2+0T9uEuvlHHp2ZkJHc2zZpAWQ4jXdW5L7qG335NaQLr6OSYdbydwDg1PmlS8/Wu33rWGLmdN4sxAX1wGMnKm9EXWyuc06BwbVNm0+REmztmNbw1W/Vcg64y+dFipTqYizrYa5pYmTbmbmfZmcxzTjPXnO6zpvb8mYuym8jJvFDnCDPTxT6oi31SF/uoLuZZyc8mO5X9TOf6nPU/MICSSQ=="}),t[2]||(t[2]=r('<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>分区（Partitioning/Sharding）是将大型数据集分割成更小部分并分布到多个节点的技术。与复制不同，分区的目标是<strong>将数据和查询负载均匀地分布在各节点上</strong>，实现水平扩展。</p><h3 id="分区的目标" tabindex="-1"><a class="header-anchor" href="#分区的目标"><span>分区的目标</span></a></h3><ul><li><strong>可扩展性</strong>：数据量超过单机容量时，分布到多台机器</li><li><strong>性能</strong>：查询负载分散到多个节点并行处理</li><li><strong>可用性</strong>：结合复制，提高系统容错能力</li></ul><h2 id="分区策略" tabindex="-1"><a class="header-anchor" href="#分区策略"><span>分区策略</span></a></h2><h3 id="键范围分区" tabindex="-1"><a class="header-anchor" href="#键范围分区"><span>键范围分区</span></a></h3><p>为每个分区分配连续的键范围：</p>',7)),e(a,{id:"mermaid-44",code:"eJxLL0osyFDwCeJSAALH6JdT1j1fuevl9C2xCrq6dgoBhtFPO9qe9uwytFJw1HWLhaiCSBlBpYysFNx1fVGkjKFSxlYKfrrBKFImUCkTK4UQ3ahYLrBccUllTipQRVpmTo6VsqWBs6ObpU5xSVF+dqqVsqGpmamzAZSrW56ZUpJhZVRQgaQxwBCq09HUxczRHK7TyNXcxdgIr04jsnUak63ThDSdAHTfhBQ="}),t[3]||(t[3]=r('<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>支持高效范围查询</td><td>容易产生热点</td></tr><tr><td>键在分区内有序存储</td><td>时间戳等顺序键问题严重</td></tr><tr><td>分区边界可动态调整</td><td>需要维护分区元数据</td></tr></tbody></table><p><strong>热点问题示例</strong>：如果按时间戳分区，所有当天的写入都会集中到同一分区。</p><h3 id="哈希分区" tabindex="-1"><a class="header-anchor" href="#哈希分区"><span>哈希分区</span></a></h3><p>使用哈希函数将键映射到分区：</p><h4 id="哈希取模" tabindex="-1"><a class="header-anchor" href="#哈希取模"><span>哈希取模</span></a></h4>',5)),e(a,{id:"mermaid-95",code:"eJxLL0osyFDwCeJSAALvaO/UylgFXV07BY/ojMTijKfte59N3RALlvQAi/tGP+2f9mzFQgVVBT+IuC9YPCD6aUfb055dz/dMe9q/PZYLLFVcUpmTquCtkJaZk2OlbGng7OhmqVNcUpSfnWqlbGhqZupsAOXqlmemlGRYGRVUIGn0gGp0c3M1sDCCa3Rzs3AzwKvRl1yNAVCNjqYuZo7mcI1GruYuxjBzkDQCAAhZZpw="}),t[4]||(t[4]=d("p",null,[d("strong",null,"问题"),n("：节点数 N 变化时，几乎所有数据都需要重新分配。")],-1)),t[5]||(t[5]=d("h4",{id:"一致性哈希",tabindex:"-1"},[d("a",{class:"header-anchor",href:"#一致性哈希"},[d("span",null,"一致性哈希")])],-1)),e(a,{id:"mermaid-102",code:"eJxLL0osyFDwCeJSAALvaO/UylgFXV07BY/ojMTijKfte59N3RALlvQAiwdFP53c8XRHz/O+9U92dD2f1fJkb+/zvesgSoLASoKjXy7c9Wz6tpeTOp7NX/qscx9EMhgs6Rf9fM2aJzsanuxY9aKr6XnTzlgusGxxSWVOqoK3QlpmTo6VsqWBs6ObpU5xSVF+dqqVsqGpmamzAZSrW56ZUpJhZVRQgaTRA6rRzc3VwMIIrtHNzcLNAK/GIKhGZ1dLYxcLuEYzR0MnS0d8GoPJ1egH1eho6mLmaA7XaORq7mIMczmSRgA9k5Ik"}),t[6]||(t[6]=d("p",null,[d("strong",null,"优点"),n("：节点变化时只影响相邻节点的数据。")],-1)),t[7]||(t[7]=d("h4",{id:"固定数量分区",tabindex:"-1"},[d("a",{class:"header-anchor",href:"#固定数量分区"},[d("span",null,"固定数量分区")])],-1)),e(a,{id:"mermaid-109",code:"eJxLL0osyFDwCeJSAILg6Oebdz/fPT9WQVfXTiEg+mnH7Ke7dz2dvevpulnPpm542d7/tKPtac8um6Qifbuny5oMDQwMnuxYFQvWHADW5GcY/aKr6XnTTkOwoufrFj6f0AbRZahrZGqAotYIqtYIQ62RqaGuqQGqamOoamMM1aYGhrrmaGabQFWbYKg2B5oNcnksF1h9cUllTqpCsEJaZk6OlbKlgbOjm6VOcUlRfnaqlbKhqZmpswGUq1uemVKSYWVUUIGkMQCq0c3N1cDCCK7Rzc3CzQCvRj9DqE5HUxczR3O4TiNXcxdjmEHYdRqRrdOYbJ0mpOkEAAIq1hM="}),t[8]||(t[8]=r('<p><strong>优点</strong>：</p><ul><li>添加/删除节点时只需重新分配整个分区</li><li>分区大小相对均匀</li><li>运维可预测</li></ul><h3 id="分区策略对比" tabindex="-1"><a class="header-anchor" href="#分区策略对比"><span>分区策略对比</span></a></h3><table><thead><tr><th>策略</th><th>范围查询</th><th>负载均衡</th><th>热点风险</th><th>实现复杂度</th></tr></thead><tbody><tr><td>键范围</td><td>高效</td><td>较差</td><td>高</td><td>中等</td></tr><tr><td>哈希取模</td><td>不支持</td><td>好</td><td>低</td><td>简单</td></tr><tr><td>一致性哈希</td><td>不支持</td><td>好</td><td>低</td><td>中等</td></tr><tr><td>固定分区</td><td>取决于键</td><td>好</td><td>中等</td><td>中等</td></tr></tbody></table><h3 id="复合分区键" tabindex="-1"><a class="header-anchor" href="#复合分区键"><span>复合分区键</span></a></h3><p>结合哈希和范围分区的优点：</p>',6)),e(a,{id:"mermaid-230",code:"eJxLL0osyFDwCeJSAALv6KdLep9O6Hg5ZZ2VTVKRvl1pcWpRfGaKjkJJZm5qcUlibkGsgq6unYJH9LOeTqjk08kdT3f0xIIN8ADLBkQ/X7ju6bpZTzvanvbsgsgEgGWCoyFiT9tagQbADX3WN+nprv5YLrDK4pLKnFQFb4W0zJwcK2VLA2dHN0ud4pKi/OxUK2VDUzNTZwMoV7c8M6Ukw8qooAJJowdUo5ubq4GFEVyjm5uFmwFejQFQjY6mLmaO5nCNRq7mLsYwc7BqDIZqdHa1NHaxgGs0czR0snTE1AgA4IOCvA=="}),t[9]||(t[9]=d("p",null,[d("strong",null,"应用场景"),n("：社交媒体时间线、用户活动日志等。")],-1)),t[10]||(t[10]=d("h2",{id:"分区与二级索引",tabindex:"-1"},[d("a",{class:"header-anchor",href:"#分区与二级索引"},[d("span",null,"分区与二级索引")])],-1)),t[11]||(t[11]=d("h3",{id:"本地索引-文档分区",tabindex:"-1"},[d("a",{class:"header-anchor",href:"#本地索引-文档分区"},[d("span",null,"本地索引（文档分区）")])],-1)),t[12]||(t[12]=d("p",null,"每个分区维护自己的二级索引，仅覆盖本分区数据：",-1)),e(a,{id:"mermaid-243",code:"eJxLL0osyFDwCeJSAIIAw+inHW1Pe3YZxiro6topuBhGP5u64VnvulioNFjUEyg6Z83TORueb1n0dM/UWC6IpBFUrxFUrxGqXiOIXqAoFr3GUL3GUL3GqHqNIXqBoph6i0sqc1JBTkvLzMmxUrY0cHZ0s9QpLinKz061UjY0NTN1NoBydcszU0oyrIwKKpB1GpGt05hcnS4w1zqaupg5msN1Grmauxgb4dUJcy3pOmGuJVmnJ8y1bm6uBhYwpSCuhZsBXn96wlxLuk6Ya4nUCQA3K+u4"}),t[13]||(t[13]=r('<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>写入简单，只更新本地索引</td><td>查询需要分散/聚集到所有分区</td></tr><tr><td>分区独立，无跨分区协调</td><td>读取延迟高，尾延迟问题</td></tr></tbody></table><h3 id="全局索引-词条分区" tabindex="-1"><a class="header-anchor" href="#全局索引-词条分区"><span>全局索引（词条分区）</span></a></h3><p>索引覆盖所有分区数据，但索引本身也需要分区：</p>',3)),e(a,{id:"mermaid-280",code:"eJxLL0osyFDwCeJSAAKX6GedDc/mdD6buuFZ77qnHW1Pe3bFKujq2il4GkY/37Lo6Z6pEEFDm6QifTtHXd9YiD6IGiMUNUZgNX66UbFcYEXFJZU5qUClaZk5OVbKlgbOjm6WOsUlRfnZqVbKhqZmps4GUK5ueWZKSYaVUUEFkkZPQ6hONzdXAwsjuE43Nws3A/w6jUjTCQB42WDj"}),t[14]||(t[14]=r('<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>查询效率高，只访问相关分区</td><td>写入复杂，可能需要更新多个索引分区</td></tr><tr><td>避免分散/聚集</td><td>可能需要分布式事务</td></tr></tbody></table><h2 id="分区再平衡" tabindex="-1"><a class="header-anchor" href="#分区再平衡"><span>分区再平衡</span></a></h2><h3 id="再平衡策略" tabindex="-1"><a class="header-anchor" href="#再平衡策略"><span>再平衡策略</span></a></h3><table><thead><tr><th>策略</th><th>描述</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>固定分区数</td><td>预先创建大量分区</td><td>简单可预测</td><td>分区数难以调整</td></tr><tr><td>动态分区</td><td>分区过大时分裂</td><td>自适应数据量</td><td>实现复杂</td></tr><tr><td>按节点比例</td><td>每个节点固定分区数</td><td>自动扩展</td><td>新节点加入时数据迁移</td></tr></tbody></table><h3 id="自动-vs-手动再平衡" tabindex="-1"><a class="header-anchor" href="#自动-vs-手动再平衡"><span>自动 vs 手动再平衡</span></a></h3><p><strong>自动再平衡</strong>：</p><ul><li>优点：方便，无需人工干预</li><li>缺点：不可预测，可能触发级联故障</li></ul><p><strong>手动再平衡</strong>：</p><ul><li>优点：可控，可防止意外操作</li><li>缺点：较慢，需要运维介入</li></ul><blockquote><p>许多生产系统选择半自动方式：系统建议再平衡计划，由管理员确认执行。</p></blockquote><h2 id="请求路由" tabindex="-1"><a class="header-anchor" href="#请求路由"><span>请求路由</span></a></h2><h3 id="三种路由方式" tabindex="-1"><a class="header-anchor" href="#三种路由方式"><span>三种路由方式</span></a></h3>',12)),e(a,{id:"mermaid-423",code:"eJxLL0osyFDwCeJSAAJnw+in6xY969j+fPX6WAVdXTsFP8PoJ7t3P2vpf9HV9LxpZyxYmZ8hRM4o+sXeNU/7Jz7t2PBs7eLnC9fBFEEMM0I3LCj6xfb1z6dsfLqxCWJQEMQc42hs2o0x3GIS/Xz2lmd9S1/snwcksegpLqnMSQX6QiEtMyfHStnSwNnRzVKnuKQoPzvVStnQ1MzU2QDK1S3PTCnJsDIqqEDWaUS2TmNydQIDE6LTzc3VwMIIrtPNzcLNAL9OmGsdTV3MHM3hOo1czV2MYQZh1RkE1ejsamnsYgHXaOZo6GTpiNdKmDdJttLPhDSdAGgp7Wo="}),t[15]||(t[15]=r('<h3 id="分区发现" tabindex="-1"><a class="header-anchor" href="#分区发现"><span>分区发现</span></a></h3><p>系统需要知道&quot;哪个分区在哪个节点&quot;：</p><table><thead><tr><th>方案</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>协调服务</td><td>使用 ZooKeeper/etcd 存储映射</td><td>Kafka, HBase</td></tr><tr><td>Gossip 协议</td><td>节点间传播分区信息</td><td>Cassandra, Riak</td></tr><tr><td>配置服务</td><td>中心化配置管理</td><td>MongoDB Config Server</td></tr></tbody></table><h3 id="zookeeper-在分区发现中的作用" tabindex="-1"><a class="header-anchor" href="#zookeeper-在分区发现中的作用"><span>ZooKeeper 在分区发现中的作用</span></a></h3>',4)),e(a,{id:"mermaid-483",code:"eJxLL0osyFDwCeJSAAK/6BddTc+bdsYq6OraKURFR+Xne6emFqQWPdu84mlbTyxYURRY0jf6+e4tz7qWPO1oe9qz62nHBojOZzMWPN3QAlHoC1YYHP1i+/rnUzY+3dik/3Tdomcd25+vXv9i3aKXM1ohyoLBykKjoSb1z3jaM+3Z9G0vG2Y9n780lgusprikMidVwU8hLTMnx0rZ0sDZ0c1Sp7ikKD871UrZ0NTM1NkAytUtz0wpybAyKqhA0hgF1ejm5mpgYQTX6OZm4WaAV6MvVKOzq6WxiwVco5mjoZOlIz6NwVCNjqYuZo7mcI1GruYuxjAHYNUYCneqo5OlIVyji4WJsaEppkYAI1ylrA=="}),t[16]||(t[16]=r('<h2 id="热点处理" tabindex="-1"><a class="header-anchor" href="#热点处理"><span>热点处理</span></a></h2><h3 id="热点产生原因" tabindex="-1"><a class="header-anchor" href="#热点产生原因"><span>热点产生原因</span></a></h3><ul><li>某些键访问频率远高于其他键（如热门用户）</li><li>时间相关的键导致写入集中</li><li>数据分布不均匀</li></ul><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h3><p><strong>应用层分散</strong>：</p>',5)),e(a,{id:"mermaid-513",code:"eJxLL0osyFDwCeJSAILw6KdtM5+2Lo1V0NW1U/COzk6tVLBVyC/KTM/MS8yJB3G1FYoS81Lyc2PBGoKiX6zf/bR/GkRDYPSz+UtfrF/0rLPh2ZxOvyc7Vj3tn/Fk72SI2kCwGt/opxM6nu7c9nz35Gfz5sRygaWKSypzUhXCFdIyc3KslC0NnB3dLHWKS4rys1OtlA1NzUydDaBc3fLMlJIMK6OCCiSN3lCNbm6uBhZGcI1ubhZuBng1BpFrYyBUo7OrpbGLBVyjmaOhk6UjPo2+UI2Opi5mjuZwjUau5i7GMJcjaQQABkGObg=="}),t[17]||(t[17]=r('<p><strong>专用分区</strong>：</p><ul><li>将热键放在专用分区</li><li>为热分区分配更多资源</li></ul><p><strong>系统自动处理</strong>：</p><ul><li>一些数据库支持自动检测和分散热点</li></ul><h2 id="多租户分区" tabindex="-1"><a class="header-anchor" href="#多租户分区"><span>多租户分区</span></a></h2><p>分区常用于实现多租户系统：</p>',6)),e(a,{id:"mermaid-545",code:"eJydzkEKgkAUBuB9pxDaJjgzzqQugnF0Vi0k2omLIEtJSFSoLhAuukPLjhB0H+saFT6lIISc3fzv/x5vnS3SSJnOBsrrzbn/uJzv5ZUHiqpOFA/5VXmsTjcUwLyOMcQ4GNS5Dc4GR6BAmoKAgoCCDgUdFos6phDT75hBzGBdXhyS8H3NKk4Sa2hqgktzlBfZdhNaQ0QZFRp81V28LCILp/tPaYOU0tUM3EopDal1SwFSuCZxjFYyjmyTd0kPgeTUYXzcSuyOHdKc8Fvi3pL0lnpvSXtL9p98Ag9y4FM="}),t[18]||(t[18]=r('<p><strong>优势</strong>：</p><ul><li>资源隔离和权限隔离</li><li>基于单元的架构实现故障隔离</li><li>按租户备份恢复</li><li>渐进式模式推出</li></ul><h2 id="核心要点" tabindex="-1"><a class="header-anchor" href="#核心要点"><span>核心要点</span></a></h2><ul><li>分区是实现水平扩展的关键技术</li><li>选择分区策略需要权衡范围查询和负载均衡</li><li>二级索引分区需要在读写效率间权衡</li><li>再平衡策略影响系统可用性和运维复杂度</li><li>热点是分区系统的常见挑战，需要专门处理</li></ul>',4))])}const b=s(h,[["render",p]]),c=JSON.parse('{"path":"/ddia/bxqsc20o/","title":"第7章 分区","lang":"zh-CN","frontmatter":{"title":"第7章 分区","createTime":"2025/12/26 16:13:52","permalink":"/ddia/bxqsc20o/"},"headers":[],"readingTime":{"minutes":8.89,"words":2666},"git":{"updatedTime":1766740079000,"contributors":[{"name":"aidenreed937","username":"aidenreed937","email":"aidenreed937@gmail.com","commits":4,"avatar":"https://avatars.githubusercontent.com/aidenreed937?v=4","url":"https://github.com/aidenreed937"},{"name":"Claude Opus 4.5","username":"Claude Opus 4.5","email":"noreply@anthropic.com","commits":3,"avatar":"https://avatars.githubusercontent.com/Claude Opus 4.5?v=4","url":"https://github.com/Claude Opus 4.5"},{"name":"Claude Sonnet 4.5","username":"Claude Sonnet 4.5","email":"noreply@anthropic.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Claude Sonnet 4.5?v=4","url":"https://github.com/Claude Sonnet 4.5"}]},"filePathRelative":"notes/ddia/part2-distributed/chapter-07.md","bulletin":false}');export{b as comp,c as data};
