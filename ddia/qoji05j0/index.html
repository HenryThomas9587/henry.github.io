<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.19" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><title>第4章 存储与检索 | My Vuepress Site</title><meta name="description" content=""><link rel="preload" href="/henry.github.io/assets/style-iCC0LYON.css" as="style"><link rel="stylesheet" href="/henry.github.io/assets/style-iCC0LYON.css"><link rel="modulepreload" href="/henry.github.io/assets/app-BNwF3TyR.js"><link rel="modulepreload" href="/henry.github.io/assets/index.html-CtMQFAzy.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-6b855051><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-6665853b></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-6665853b> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-6b855051 data-v-b27f9974><div class="vp-navbar" vp-navbar data-v-b27f9974 data-v-bd857425><div class="wrapper" data-v-bd857425><div class="container" data-v-bd857425><div class="title" data-v-bd857425><div class="vp-navbar-title has-sidebar" data-v-bd857425 data-v-2ef7f17a><a class="vp-link no-icon link title" href="/henry.github.io/" data-v-2ef7f17a data-v-87b5717a><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="https://theme-plume.vuejs.press/plume.png" alt data-v-e3c54c70><!--]--><!--[--><img class="vp-image light logo" src="https://theme-plume.vuejs.press/plume.png" alt data-v-e3c54c70><!--]--><!--]--><!--]--><span data-v-2ef7f17a>My Vuepress Site</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-bd857425><div class="content-body" data-v-bd857425><!--[--><!--]--><div class="vp-navbar-search search" data-v-bd857425><div class="search-wrapper" data-v-42ff2bf3><!----><div id="local-search" data-v-42ff2bf3><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-42ff2bf3><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-bd857425 data-v-6d8fb5f6><span id="main-nav-aria-label" class="visually-hidden" data-v-6d8fb5f6>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/henry.github.io/" tabindex="0" data-v-6d8fb5f6 data-v-ac70cb14 data-v-87b5717a><!--[--><!----><span data-v-ac70cb14>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/henry.github.io/blog/" tabindex="0" data-v-6d8fb5f6 data-v-ac70cb14 data-v-87b5717a><!--[--><!----><span data-v-ac70cb14>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/henry.github.io/blog/tags/" tabindex="0" data-v-6d8fb5f6 data-v-ac70cb14 data-v-87b5717a><!--[--><!----><span data-v-ac70cb14>标签</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/henry.github.io/blog/archives/" tabindex="0" data-v-6d8fb5f6 data-v-ac70cb14 data-v-87b5717a><!--[--><!----><span data-v-ac70cb14>归档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-6d8fb5f6 data-v-f5157cbd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f5157cbd><span class="text" data-v-f5157cbd><!----><!----><span data-v-f5157cbd>笔记</span><span class="vpi-chevron-down text-icon" data-v-f5157cbd></span></span></button><div class="menu" data-v-f5157cbd><div class="vp-menu" data-v-f5157cbd data-v-22b26cbd><div class="items" data-v-22b26cbd><!--[--><!--[--><div class="vp-menu-link" data-v-22b26cbd data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/android/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> Android<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-22b26cbd data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/ddia/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> DDIA 学习笔记<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-22b26cbd data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/demo/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> Demo<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-22b26cbd data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/flutter/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> Flutter<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-22b26cbd data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/ui/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> Ui<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="vp-flyout vp-navbar-translations translations" data-v-bd857425 data-v-0ffcc6de data-v-f5157cbd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="选择语言" data-v-f5157cbd><span class="text" data-v-f5157cbd><!----><span class="vpi-languages option-icon" data-v-f5157cbd></span><!----><span class="vpi-chevron-down text-icon" data-v-f5157cbd></span></span></button><div class="menu" data-v-f5157cbd><div class="vp-menu" data-v-f5157cbd data-v-22b26cbd><!----><!--[--><!--[--><div class="items" data-v-0ffcc6de><p class="title" data-v-0ffcc6de>简体中文</p><!--[--><div class="vp-menu-link" data-v-0ffcc6de data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/en/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> English<!--]--><!----></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="vp-navbar-appearance appearance" data-v-bd857425 data-v-d9c55eda><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-d9c55eda data-v-ad1b2bdf data-v-61405998><span class="check" data-v-61405998><span class="icon" data-v-61405998><!--[--><span class="vpi-sun sun" data-v-ad1b2bdf></span><span class="vpi-moon moon" data-v-ad1b2bdf></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-bd857425 data-v-26cdeb54 data-v-03411773><!--[--><a class="vp-social-link no-icon" href="/" aria-label="github" target="_blank" rel="noopener" data-v-03411773 data-v-4463c1f8><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-bd857425 data-v-ff262915 data-v-f5157cbd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-f5157cbd><span class="vpi-more-horizontal icon" data-v-f5157cbd></span></button><div class="menu" data-v-f5157cbd><div class="vp-menu" data-v-f5157cbd data-v-22b26cbd><!----><!--[--><!--[--><div class="group translations" data-v-ff262915><p class="trans-title" data-v-ff262915>简体中文</p><!--[--><div class="vp-menu-link" data-v-ff262915 data-v-d5eb0fee><a class="vp-link no-icon link" href="/henry.github.io/en/" data-v-d5eb0fee data-v-87b5717a><!--[--><!----> English<!--]--><!----></a></div><!--]--></div><div class="group" data-v-ff262915><div class="item appearance" data-v-ff262915><p class="label" data-v-ff262915>外观</p><div class="appearance-action" data-v-ff262915><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-ff262915 data-v-ad1b2bdf data-v-61405998><span class="check" data-v-61405998><span class="icon" data-v-61405998><!--[--><span class="vpi-sun sun" data-v-ad1b2bdf></span><span class="vpi-moon moon" data-v-ad1b2bdf></span><!--]--></span></span></button></div></div></div><div class="group" data-v-ff262915><div class="item social-links" data-v-ff262915><div class="vp-social-links social-links-list" data-v-ff262915 data-v-03411773><!--[--><a class="vp-social-link no-icon" href="/" aria-label="github" target="_blank" rel="noopener" data-v-03411773 data-v-4463c1f8><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-bd857425 data-v-bc2fdff4><span class="container" data-v-bc2fdff4><span class="top" data-v-bc2fdff4></span><span class="middle" data-v-bc2fdff4></span><span class="bottom" data-v-bc2fdff4></span></span></button></div></div></div></div><div class="divider" data-v-bd857425><div class="divider-line" data-v-bd857425></div></div></div><!----></header><div class="vp-local-nav reached-top is-blog" data-v-6b855051 data-v-a9fbedc4><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-a9fbedc4><span class="vpi-align-left menu-icon" data-v-a9fbedc4></span><span class="menu-text" data-v-a9fbedc4>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-a9fbedc4 data-v-efb9a031><button data-v-efb9a031>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-6b855051 data-v-e8b1f427><div class="curtain" data-v-e8b1f427></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-e8b1f427><span id="sidebar-aria-label" class="visually-hidden" data-v-e8b1f427> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c7d7fce2><section class="vp-sidebar-item sidebar-item level-0 collapsible is-link has-active" data-v-c7d7fce2 data-v-13ba94ca><div class="item" tabindex="0" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/7x9vynpy/" data-v-13ba94ca data-v-87b5717a><!--[--><h2 class="text" data-v-13ba94ca>part1-foundations</h2><!--]--><!----></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-13ba94ca><span class="vpi-chevron-right caret-icon" data-v-13ba94ca></span></div></div><div class="items" data-v-13ba94ca><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/670y7cuq/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第1章 可靠性、可扩展性与可维护性</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/ia4ww5f0/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第2章 定义非功能性需求</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/vva8j2cd/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第3章 数据模型与查询语言</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/qoji05j0/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第4章 存储与检索</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/dxwd3178/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第5章 编码与演化</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c7d7fce2><section class="vp-sidebar-item sidebar-item level-0 collapsible is-link" data-v-c7d7fce2 data-v-13ba94ca><div class="item" tabindex="0" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/499k0udf/" data-v-13ba94ca data-v-87b5717a><!--[--><h2 class="text" data-v-13ba94ca>part2-distributed</h2><!--]--><!----></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-13ba94ca><span class="vpi-chevron-right caret-icon" data-v-13ba94ca></span></div></div><div class="items" data-v-13ba94ca><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/part2-distributed/chapter-06/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第6章 复制</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/bxqsc20o/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第7章 分区</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/fm1ruuoh/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第8章 事务</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/cpolrctq/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第9章 分布式系统的麻烦</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-13ba94ca data-v-13ba94ca><div class="item" data-v-13ba94ca><div class="indicator" data-v-13ba94ca></div><!----><a class="vp-link no-icon link link" href="/henry.github.io/ddia/nydpoapn/" data-v-13ba94ca data-v-87b5717a><!--[--><p class="text" data-v-13ba94ca>第10章 一致性与共识</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-6b855051 data-v-6d75db73><div class="has-sidebar has-aside vp-doc-container" data-v-94616537><!--[--><!--]--><div class="container" data-v-94616537><div class="aside" vp-outline data-v-94616537><div class="aside-curtain" data-v-94616537></div><div class="aside-container" data-v-94616537><div class="aside-content" data-v-94616537><div class="vp-doc-aside" data-v-94616537 data-v-c5a5865a><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-c5a5865a data-v-2d954bbe><div class="content" data-v-2d954bbe><div class="outline-marker" data-v-2d954bbe></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-2d954bbe><span data-v-2d954bbe>此页内容</span><span class="vpi-print icon" data-v-2d954bbe></span></div><ul class="root" data-v-2d954bbe data-v-a404a7d7><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-c5a5865a></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-94616537><div class="content-container" data-v-94616537><!--[--><!--]--><main class="main" data-v-94616537><nav class="vp-breadcrumb" data-v-94616537 data-v-5efe8592><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-5efe8592><!--[--><li property="itemListElement" typeof="ListItem" data-v-5efe8592><a class="vp-link no-icon link breadcrumb" href="/henry.github.io/" property="item" typeof="WebPage" data-v-5efe8592 data-v-87b5717a><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-5efe8592></span><meta property="name" content="首页" data-v-5efe8592><meta property="position" content="1" data-v-5efe8592></li><li property="itemListElement" typeof="ListItem" data-v-5efe8592><a class="vp-link no-icon link breadcrumb" href="/henry.github.io/ddia/7x9vynpy/" property="item" typeof="WebPage" data-v-5efe8592 data-v-87b5717a><!--[-->part1-foundations<!--]--><!----></a><span class="vpi-chevron-right" data-v-5efe8592></span><meta property="name" content="part1-foundations" data-v-5efe8592><meta property="position" content="2" data-v-5efe8592></li><li property="itemListElement" typeof="ListItem" data-v-5efe8592><a class="vp-link no-icon link breadcrumb current" href="/henry.github.io/ddia/qoji05j0/" property="item" typeof="WebPage" data-v-5efe8592 data-v-87b5717a><!--[-->第4章 存储与检索<!--]--><!----></a><!----><meta property="name" content="第4章 存储与检索" data-v-5efe8592><meta property="position" content="3" data-v-5efe8592></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-349c6f6c>第4章 存储与检索 <!----></h1><div class="vp-doc-meta" data-v-349c6f6c><p class="reading-time" data-v-349c6f6c><span class="vpi-books icon" data-v-349c6f6c></span><span data-v-349c6f6c>约 3431 字</span><span data-v-349c6f6c>大约 11 分钟</span></p><!----><p class="create-time" data-v-349c6f6c><span class="vpi-clock icon" data-v-349c6f6c></span><span data-v-349c6f6c>2025-12-26</span></p></div><!--]--><div class="_ddia_qoji05j0_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-94616537><div data-v-94616537><h2 id="章节概览" tabindex="-1"><a class="header-anchor" href="#章节概览"><span>章节概览</span></a></h2><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>本章深入探讨数据库如何存储和检索数据，重点分析面向事务处理（OLTP）和分析处理（OLAP）两类工作负载的存储引擎架构及其基本权衡。理解存储引擎内部机制有助于选择合适的数据库并有效调优性能参数。</p><h2 id="核心概念" tabindex="-1"><a class="header-anchor" href="#核心概念"><span>核心概念</span></a></h2><h3 id="索引的必要性" tabindex="-1"><a class="header-anchor" href="#索引的必要性"><span>索引的必要性</span></a></h3><p>最简单的键值存储可以用追加写入文件实现：</p><ul><li>写入性能：O(1) - 追加操作非常快</li><li>读取性能：O(n) - 需要扫描整个文件</li><li>结论：需要索引来加速查询</li></ul><p><strong>索引的本质权衡</strong>：</p><ul><li>加速读取操作</li><li>减慢写入操作（需要维护索引结构）</li><li>占用额外存储空间</li></ul><h2 id="oltp-存储引擎" tabindex="-1"><a class="header-anchor" href="#oltp-存储引擎"><span>OLTP 存储引擎</span></a></h2><h3 id="日志结构存储引擎" tabindex="-1"><a class="header-anchor" href="#日志结构存储引擎"><span>日志结构存储引擎</span></a></h3><h4 id="sstable-sorted-string-table" tabindex="-1"><a class="header-anchor" href="#sstable-sorted-string-table"><span>SSTable（Sorted String Table）</span></a></h4><p>SSTable 是按键排序的键值对文件格式，相比简单日志文件的优势：</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p><strong>核心特性</strong>：</p><ul><li>键值对按键排序存储</li><li>支持稀疏索引（内存中只保存部分键）</li><li>高效的范围查询</li><li>块级压缩</li></ul><p><strong>工作流程</strong>：</p><ol><li>写入时追加到内存中的排序结构（memtable）</li><li>memtable 满时刷盘到磁盘成为 SSTable 段</li><li>后台合并段文件，删除重复和过期数据</li><li>使用布隆过滤器快速判断键是否存在</li></ol><h4 id="lsm-tree-log-structured-merge-tree" tabindex="-1"><a class="header-anchor" href="#lsm-tree-log-structured-merge-tree"><span>LSM-Tree（Log-Structured Merge-Tree）</span></a></h4><p>LSM-Tree 是基于 SSTable 的完整存储引擎实现。</p><p><strong>压缩策略对比</strong>：</p><table><thead><tr><th>策略类型</th><th>工作方式</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td>Size-tiered</td><td>合并多个小 SSTable 为大 SSTable</td><td>实现简单</td><td>可能产生临时空间放大</td></tr><tr><td>Leveled</td><td>数据分层，每层键范围不重叠</td><td>空间利用率高</td><td>写放大较高</td></tr></tbody></table><p><strong>布隆过滤器</strong>：</p><ul><li>概率型数据结构</li><li>快速判断键是否可能存在于段中</li><li>无假阴性，但有假阳性</li><li>显著减少不必要的磁盘读取</li></ul><h3 id="b-tree-索引" tabindex="-1"><a class="header-anchor" href="#b-tree-索引"><span>B-Tree 索引</span></a></h3><p>B-Tree 采用固定大小页面的就地更新策略，是最广泛使用的索引结构。</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p><strong>查找示例</strong>：查找 key=15 的路径: Root → [12,17] → [15,17] → 找到! <strong>时间复杂度</strong>：O(log n)</p><p><strong>核心特性</strong>：</p><ul><li>页面大小：通常 4KB-16KB</li><li>平衡树结构：查找时间复杂度 O(log n)</li><li>就地更新：覆盖磁盘页面而非追加</li><li>预写日志（WAL）：用于崩溃恢复</li></ul><p><strong>优化技术</strong>：</p><ul><li>Copy-on-write：写入新页面而非覆盖，简化并发控制</li><li>键缩写：节省页面空间，提高分支因子</li><li>页面布局：尝试将相邻键的页面放在磁盘相邻位置</li></ul><h3 id="lsm-tree-vs-b-tree-对比" tabindex="-1"><a class="header-anchor" href="#lsm-tree-vs-b-tree-对比"><span>LSM-Tree vs B-Tree 对比</span></a></h3><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><table><thead><tr><th>维度</th><th>LSM-Tree</th><th>B-Tree</th></tr></thead><tbody><tr><td>写入性能</td><td>更快（顺序写入）</td><td>较慢（随机写入）</td></tr><tr><td>读取性能</td><td>较慢（需检查多个段）</td><td>更快（单次查找）</td></tr><tr><td>写放大</td><td>压缩过程产生</td><td>页面分裂和 WAL 产生</td></tr><tr><td>空间利用</td><td>压缩率更高</td><td>可能产生碎片</td></tr><tr><td>适用场景</td><td>写密集型工作负载</td><td>读密集型工作负载</td></tr><tr><td>事务支持</td><td>实现较复杂</td><td>天然支持锁机制</td></tr></tbody></table><p><strong>经验法则</strong>：LSM-Tree 更适合写入密集型应用，B-Tree 对读取更快。</p><h3 id="其他索引结构" tabindex="-1"><a class="header-anchor" href="#其他索引结构"><span>其他索引结构</span></a></h3><h4 id="二级索引" tabindex="-1"><a class="header-anchor" href="#二级索引"><span>二级索引</span></a></h4><ul><li>主键索引：键唯一标识一行</li><li>二级索引：键可能对应多行</li><li>实现方式： <ul><li>存储实际行数据（聚簇索引）</li><li>存储主键引用（非聚簇索引）</li><li>存储行位置引用（堆文件）</li></ul></li></ul><h4 id="多维索引" tabindex="-1"><a class="header-anchor" href="#多维索引"><span>多维索引</span></a></h4><p><strong>空间索引</strong>：</p><ul><li>R-Tree：用于地理空间数据</li><li>空间填充曲线：将多维数据映射到一维</li></ul><p><strong>全文搜索索引</strong>：</p><ul><li>倒排索引：词项到文档列表的映射</li><li>N-gram 索引：支持子串匹配</li><li>Levenshtein 自动机：模糊匹配</li></ul><p><strong>向量嵌入索引</strong>：</p><ul><li>HNSW（Hierarchical Navigable Small World）</li><li>IVF（Inverted File Index）</li><li>用于语义搜索的近似最近邻查询</li></ul><h4 id="内存数据库" tabindex="-1"><a class="header-anchor" href="#内存数据库"><span>内存数据库</span></a></h4><p><strong>特点</strong>：</p><ul><li>数据主要存储在内存中</li><li>性能优势来自避免序列化开销，而非避免磁盘读取</li><li>持久化通过快照和日志实现</li><li>支持反缓存：将冷数据移到磁盘</li></ul><h2 id="olap-存储引擎" tabindex="-1"><a class="header-anchor" href="#olap-存储引擎"><span>OLAP 存储引擎</span></a></h2><h3 id="数据仓库架构" tabindex="-1"><a class="header-anchor" href="#数据仓库架构"><span>数据仓库架构</span></a></h3><p><strong>传统架构</strong>：</p><ul><li>ETL 流程：从 OLTP 系统提取、转换、加载数据</li><li>星型模式：事实表 + 维度表</li><li>雪花模式：维度表进一步规范化</li></ul><p><strong>云原生架构</strong>：</p><ul><li>计算与存储分离</li><li>弹性扩展能力</li><li>模块化组件： <ul><li>查询引擎：Trino, Spark</li><li>存储格式：Parquet, ORC</li><li>表格式：Iceberg, Delta Lake</li><li>数据目录：元数据管理</li></ul></li></ul><h3 id="列式存储" tabindex="-1"><a class="header-anchor" href="#列式存储"><span>列式存储</span></a></h3><p><strong>核心思想</strong>：按列而非按行存储数据</p><p><strong>优势</strong>：</p><ol><li>只加载查询需要的列</li><li>相似值聚集，压缩效果更好</li><li>支持向量化处理</li></ol><p><strong>压缩技术</strong>：</p><table><thead><tr><th>技术</th><th>适用场景</th><th>压缩比</th><th>查询性能</th></tr></thead><tbody><tr><td>位图编码</td><td>低基数列</td><td>极高</td><td>支持位运算</td></tr><tr><td>游程编码</td><td>排序后重复值多</td><td>高</td><td>快速扫描</td></tr><tr><td>字典编码</td><td>中等基数列</td><td>中等</td><td>需解码</td></tr></tbody></table><p><strong>位图索引示例</strong>：</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>产品ID列（基数较低）：</span></span>
<span class="line"><span>值 29: 0 0 1 0 1 0 0 1 0</span></span>
<span class="line"><span>值 30: 1 0 0 0 0 0 1 0 0</span></span>
<span class="line"><span>值 31: 0 1 0 1 0 1 0 0 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>查询 WHERE product_id IN (29, 31)：</span></span>
<span class="line"><span>按位OR: 0 1 1 1 1 1 0 1 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列式存储的写入" tabindex="-1"><a class="header-anchor" href="#列式存储的写入"><span>列式存储的写入</span></a></h3><p><strong>挑战</strong>：</p><ul><li>就地更新困难（需重写所有列文件）</li><li>解决方案：LSM-Tree 思想 <ul><li>内存中缓存写入</li><li>批量刷写到磁盘</li><li>后台合并列文件</li></ul></li></ul><h3 id="查询执行优化" tabindex="-1"><a class="header-anchor" href="#查询执行优化"><span>查询执行优化</span></a></h3><p><strong>向量化处理</strong>：</p><ul><li>批量处理多行数据</li><li>利用 CPU SIMD 指令</li><li>减少函数调用开销</li></ul><p><strong>查询编译</strong>：</p><ul><li>为特定查询生成机器码</li><li>消除解释器开销</li><li>适合复杂查询</li></ul><h3 id="物化视图与数据立方体" tabindex="-1"><a class="header-anchor" href="#物化视图与数据立方体"><span>物化视图与数据立方体</span></a></h3><p><strong>物化视图</strong>：</p><ul><li>预计算查询结果并存储</li><li>加速重复查询</li><li>需要在写入时更新</li></ul><p><strong>数据立方体（OLAP Cube）</strong>：</p><ul><li>多维度预聚合</li><li>极快的聚合查询</li><li>灵活性受限（只能查询预定义维度）</li></ul><h2 id="存储引擎选择指南" tabindex="-1"><a class="header-anchor" href="#存储引擎选择指南"><span>存储引擎选择指南</span></a></h2><h3 id="工作负载特征分析" tabindex="-1"><a class="header-anchor" href="#工作负载特征分析"><span>工作负载特征分析</span></a></h3><p><strong>OLTP 特征</strong>：</p><ul><li>大量小事务</li><li>基于主键的点查询</li><li>低延迟要求</li><li>写入频繁</li></ul><p><strong>OLAP 特征</strong>：</p><ul><li>少量大查询</li><li>扫描大量行</li><li>聚合计算密集</li><li>读取为主</li></ul><h3 id="选择决策树" tabindex="-1"><a class="header-anchor" href="#选择决策树"><span>选择决策树</span></a></h3><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h2 id="性能调优要点" tabindex="-1"><a class="header-anchor" href="#性能调优要点"><span>性能调优要点</span></a></h2><h3 id="写放大问题" tabindex="-1"><a class="header-anchor" href="#写放大问题"><span>写放大问题</span></a></h3><p><strong>定义</strong>：写入数据库的实际字节数远大于应用写入的字节数</p><p><strong>来源</strong>：</p><ul><li>LSM-Tree：压缩过程重写数据</li><li>B-Tree：WAL + 页面更新</li><li>复制：主从同步</li><li>备份：快照和归档</li></ul><p><strong>优化策略</strong>：</p><ul><li>调整压缩策略</li><li>增大页面大小</li><li>批量写入</li><li>使用 SSD（随机写入性能更好）</li></ul><h3 id="读放大问题" tabindex="-1"><a class="header-anchor" href="#读放大问题"><span>读放大问题</span></a></h3><p><strong>LSM-Tree 特有</strong>：</p><ul><li>需要检查多个 SSTable 段</li><li>布隆过滤器减少无效读取</li><li>压缩减少段数量</li><li>缓存热数据</li></ul><h3 id="空间放大问题" tabindex="-1"><a class="header-anchor" href="#空间放大问题"><span>空间放大问题</span></a></h3><p><strong>表现</strong>：</p><ul><li>B-Tree 碎片</li><li>LSM-Tree 压缩期间临时空间</li><li>多版本并发控制（MVCC）的旧版本</li></ul><p><strong>优化</strong>：</p><ul><li>定期重建索引</li><li>调整压缩触发阈值</li><li>及时清理旧版本</li></ul><h2 id="延伸思考" tabindex="-1"><a class="header-anchor" href="#延伸思考"><span>延伸思考</span></a></h2><ol><li><strong>混合工作负载</strong>：如何在同一系统中同时优化 OLTP 和 OLAP？</li><li><strong>新型硬件</strong>：NVMe SSD 和持久化内存如何改变存储引擎设计？</li><li><strong>分布式存储</strong>：本章讨论的单机存储引擎如何扩展到分布式环境？</li><li><strong>实时分析</strong>：如何在保证 OLTP 性能的同时支持实时分析查询？</li></ol><h2 id="实践建议" tabindex="-1"><a class="header-anchor" href="#实践建议"><span>实践建议</span></a></h2><ol><li><strong>基准测试</strong>：在实际工作负载下测试不同存储引擎</li><li><strong>监控指标</strong>：关注写放大、读放大、空间放大</li><li><strong>参数调优</strong>：根据工作负载特征调整压缩策略、缓存大小等</li><li><strong>架构演进</strong>：从单体数据库到分离式架构的渐进式迁移</li></ol></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-94616537 data-v-76964c65><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-76964c65><span class="contributors-label" data-v-76964c65>贡献者: </span><span class="contributors-info" data-v-76964c65><!--[--><!--[--><span class="contributor" data-v-76964c65>aidenreed937</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" data-v-76964c65>Claude Opus 4.5</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" data-v-76964c65>Claude Sonnet 4.5</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-76964c65><div class="pager" data-v-76964c65><a class="vp-link no-icon link pager-link prev" href="/henry.github.io/ddia/vva8j2cd/" data-v-76964c65 data-v-87b5717a><!--[--><span class="desc" data-v-76964c65>上一页</span><span class="title" data-v-76964c65>第3章 数据模型与查询语言</span><!--]--><!----></a></div><div class="pager" data-v-76964c65><a class="vp-link no-icon link pager-link next" href="/henry.github.io/ddia/dxwd3178/" data-v-76964c65 data-v-87b5717a><!--[--><span class="desc" data-v-76964c65>下一页</span><span class="title" data-v-76964c65>第5章 编码与演化</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-6b855051 style="display:none;" data-v-41e7b746><span class="percent" data-allow-mismatch data-v-41e7b746>0%</span><span class="show icon vpi-back-to-top" data-v-41e7b746></span><svg aria-hidden="true" data-v-41e7b746><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-41e7b746></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-6b855051 data-v-5f4a75b0><!--[--><div class="container" data-v-5f4a75b0><p class="message" data-v-5f4a75b0>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/henry.github.io/assets/app-BNwF3TyR.js" defer></script></body></html>